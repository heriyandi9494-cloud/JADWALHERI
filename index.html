<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jadwal Aktivitas Sehari-hari</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body {
    background-color: #f0f4f8;
    font-family: Arial, sans-serif;
    padding: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    text-align: center;
    padding: 10px;
    border-radius: 8px;
    transition: all 0.3s ease;
  }
  th {
    background-color: #0663f8;
    color: white;
  }
  tr:nth-child(even) td {
    background-color: #e3f2fd;
  }
  tr:hover td {
    background-color: #ffe082;
    cursor: pointer;
  }
  select, input[type="time"], input[type="date"] {
    width: 100%;
    padding: 5px;
    border-radius: 5px;
    border: 1px solid #ccc;
  }
  .keterangan {
    font-weight: bold;
    color: #d32f2f;
  }
  /* Highlight berdasarkan aktivitas */
  .Tidur { background-color: #b2dfdb !important; }
  .Kerja { background-color: #ffcc80 !important; }
  .Belajar { background-color: #c5cae9 !important; }
  .Olahraga { background-color: #aed581 !important; }
  .Santai { background-color: #f48fb1 !important; }
  .hapus-btn {
    color: #fff;
    background-color: #d32f2f;
    border: none;
    padding: 3px 7px;
    border-radius: 5px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h2 class="text-center mb-4">ğ‰ğšğğ°ğšğ¥ ğ€ğ¤ğ­ğ¢ğ¯ğ¢ğ­ğšğ¬ ğ“ğğŒğ˜ğ‚ğ” ğ’ğğ¡ğšğ«ğ¢-ğ¡ğšğ«ğ¢</h2>

<!-- Progress Bar Produktif -->
<div class="mb-3">
  <label>ğ“ğ¨ğ­ğšğ¥ ğğ«ğ¨ğğ®ğ¤ğ­ğ¢ğŸ ğ‡ğšğ«ğ¢ ğˆğ§ğ¢:</label>
  <div class="progress">
    <div id="progressProduktif" class="progress-bar bg-success" role="progressbar" style="width:0%">0%</div>
  </div>
</div>

<table class="table table-responsive" id="jadwal-table">
  <thead>
    <tr>
      <th>ğğ¨.</th>
      <th>ğ‡ğšğ«ğ¢</th>
      <th>ğ“ğšğ§ğ ğ ğšğ¥</th>
      <th>ğ‰ğğ§ğ¢ğ¬ ğ€ğ¤ğ­ğ¢ğ¯ğ¢ğ­ğšğ¬</th>
      <th>ğ–ğšğ¤ğ­ğ® ğŒğ®ğ¥ğšğ¢</th>
      <th>ğ–ğšğ¤ğ­ğ® ğ’ğğ¥ğğ¬ğšğ¢</th>
      <th>ğğğ«ğ¬ğğ§ğ­ğšğ¬ğ ğğ«ğ¨ğğ®ğ¤ğ­ğ¢ğŸ</th>
      <th>ğŠğğ­ğğ«ğšğ§ğ ğšğ§</th>
      <th>ğ€ğ¤ğ¬ğ¢</th>
    </tr>
  </thead>
  <tbody id="jadwal-body"></tbody>
</table>

<script>
// Inisialisasi data dari localStorage
let jadwalData = JSON.parse(localStorage.getItem('jadwalData')) || [];

// Fungsi menambahkan baris
function tambahBaris(data={}, index=null){
  const tbody = document.getElementById('jadwal-body');
  const row = tbody.insertRow(index===null ? -1 : index);

  const no = row.insertCell();
  const hari = row.insertCell();
  const tanggal = row.insertCell();
  const jenis = row.insertCell();
  const mulai = row.insertCell();
  const selesai = row.insertCell();
  const produktif = row.insertCell();
  const keterangan = row.insertCell();
  const aksi = row.insertCell();

  // Nomor urut
  no.innerText = tbody.rows.length;

  // Hari
  hari.contentEditable = true;
  hari.innerText = data.hari || '';

  // Tanggal
  tanggal.innerHTML = `<input type="date" value="${data.tanggal || ''}" onchange="updateData(this)">`;

  // Jenis Aktivitas
  jenis.innerHTML = `
    <select onchange="updateData(this)">
      <option value="Tidur" ${data.jenis==='Tidur'?'selected':''}>Tidur</option>
      <option value="Kerja" ${data.jenis==='Kerja'?'selected':''}>Kerja</option>
      <option value="Belajar" ${data.jenis==='Belajar'?'selected':''}>Belajar</option>
      <option value="Olahraga" ${data.jenis==='Olahraga'?'selected':''}>Olahraga</option>
      <option value="Santai" ${data.jenis==='Santai'?'selected':''}>Santai</option>
    </select>
  `;

  // Waktu Mulai
  mulai.innerHTML = `<input type="time" value="${data.mulai || ''}" onchange="updateData(this)">`;
  // Waktu Selesai
  selesai.innerHTML = `<input type="time" value="${data.selesai || ''}" onchange="updateData(this)">`;

  // Persentase & keterangan
  produktif.className = 'produktif';
  produktif.innerText = data.produktif || '0%';
  keterangan.className = 'keterangan';
  keterangan.innerText = data.keterangan || '';

  // Aksi hapus
  aksi.innerHTML = `<button class="hapus-btn" onclick="hapusBaris(this)">Hapus</button>`;

  // Highlight warna sesuai jenis aktivitas
  updateRowColor(row);

  // Simpan otomatis ke localStorage
  saveData();

  // Tambah baris otomatis jika ini baris terakhir
  row.querySelectorAll('input, select').forEach(input=>{
    input.addEventListener('change', ()=>{
      hitungProduktif(row);
      updateProgress();
      if(row.rowIndex === tbody.rows.length && isRowFilled(row)){
        tambahBaris();
      }
    });
  });

  updateProgress();
}

// Fungsi update data
function updateData(elem){
  const row = elem.closest('tr');
  hitungProduktif(row);
  updateRowColor(row);
  saveData();
  updateProgress();
}

// Fungsi cek apakah row diisi
function isRowFilled(row){
  return [...row.querySelectorAll('input, select')].some(i => i.value);
}

// Hitung persentase produktif
function hitungProduktif(row){
  const mulai = row.cells[4].querySelector('input').value;
  const selesai = row.cells[5].querySelector('input').value;
  const aktivitas = row.cells[3].querySelector('select').value;

  let produktifVal = 0;
  let keteranganVal = '';

  if(mulai && selesai){
    let start = new Date(`1970-01-01T${mulai}:00`);
    let end = new Date(`1970-01-01T${selesai}:00`);
    let diff = (end - start)/(1000*60*60);
    if(diff < 0) diff += 24;

    if(aktivitas.toLowerCase() !== 'tidur'){
      produktifVal = Math.round((diff/(24-8))*100);
    } else {
      produktifVal = 0;
    }

    // Keterangan sesuai aturan baru
    if(produktifVal >= 75){
      keteranganVal = 'ğ“ğğŒğ˜ğ‚ğ”! ğ€ğ­ğ®ğ« ğ°ğšğ¤ğ­ğ® ğ¢ğ¬ğ­ğ¢ğ«ğšğ¡ğšğ­ ğ€ğ§ğğš';
      row.cells[7].style.color = 'red'; // warna merah
    } else if(produktifVal >= 0 && produktifVal < 75){
      keteranganVal = 'ğ“ğğŒğ˜ğ‚ğ”! ğ–ğšğ¤ğ­ğ® ğ¢ğ¬ğ­ğ¢ğ«ğšğ¡ğšğ­ ğ€ğ§ğğš ğœğ®ğ¤ğ®ğ©';
      row.cells[7].style.color = 'black'; // warna hitam
    } else if(produktifVal < 0){
      keteranganVal = 'ğ“ğğŒğ˜ğ‚ğ”! ğ–ğšğ¤ğ­ğ® ğ¢ğ¬ğ­ğ¢ğ«ğšğ¡ğšğ­ ğ€ğ§ğğš ğ¬ğšğ§ğ ğšğ­ ğ›ğšğ¢ğ¤';
      row.cells[7].style.color = 'black'; // warna hitam
    }
  }

  row.cells[6].innerText = produktifVal + '%';
  row.cells[7].innerText = keteranganVal;
}


// Simpan data ke localStorage
function saveData(){
  const tbody = document.getElementById('jadwal-body');
  const data = [];
  for(let row of tbody.rows){
    data.push({
      hari: row.cells[1].innerText,
      tanggal: row.cells[2].querySelector('input').value,
      jenis: row.cells[3].querySelector('select').value,
      mulai: row.cells[4].querySelector('input').value,
      selesai: row.cells[5].querySelector('input').value,
      produktif: row.cells[6].innerText,
      keterangan: row.cells[7].innerText
    });
  }
  localStorage.setItem('jadwalData', JSON.stringify(data));
}

// Hapus baris
function hapusBaris(btn){
  const row = btn.closest('tr');
  row.remove();
  saveData();
  updateNoUrut();
  updateProgress();
}

// Update nomor urut
function updateNoUrut(){
  const tbody = document.getElementById('jadwal-body');
  for(let i=0; i<tbody.rows.length; i++){
    tbody.rows[i].cells[0].innerText = i+1;
  }
}

// Update progress bar total produktif
function updateProgress(){
  const tbody = document.getElementById('jadwal-body');
  let totalProduktif = 0;
  let count = 0;
  for(let row of tbody.rows){
    let val = parseInt(row.cells[6].innerText) || 0;
    totalProduktif += val;
    count++;
  }
  const avg = count ? Math.round(totalProduktif/count) : 0;
  const bar = document.getElementById('progressProduktif');
  bar.style.width = avg + '%';
  bar.innerText = avg + '%';
}

// Load data dari localStorage
jadwalData.forEach(d => tambahBaris(d));
if(jadwalData.length === 0) tambahBaris();
</script>

</body>
</html>
