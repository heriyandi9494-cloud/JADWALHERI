<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aktivitas Harian Heri</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #0a0a0a;
  margin:0;
  padding:20px;
  color: #f90505; /* <-- Ubah ini sesuai warna yang diinginkan */

}

h1 {
  text-align:center;
  margin-bottom:20px;
}

/* --- Container atas (filter + tombol) --- */
.top-controls {
  display: flex;
  flex-wrap: wrap;
  gap:10px;
  justify-content:center;
  margin-bottom:15px;
}

#filterDate {
  max-width:200px;
  width:100%;
  padding:6px 10px;
  box-sizing:border-box;
}

/* --- Tabel --- */
table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom:15px;
  font-size:14px;
}
table th, table td {
  border: 1px solid #f4f1f1;
  padding:6px 8px;
  text-align:center;
}
table th {
  background:#000d0c;
  color:rgb(4, 243, 239);
}

/* --- Select / input responsive --- */
select, input[type="time"], input[type="date"] {
  width:100%;
  box-sizing:border-box;
  padding:4px;
}

/* --- Warna hari --- */
.day-cell.day-senin {background:#3606f500;}
.day-cell.day-selasa {background:#f5045400;}
.day-cell.day-rabu {background:#f1970600;}
.day-cell.day-kamis {background:#6504f600;}
.day-cell.day-jumat {background:#08f11b00;}
.day-cell.day-sabtu {background:#f1dd0600;}
.day-cell.day-minggu {background:#f4012600;}

/* --- Warna pagi / malam --- */
.time-morning {background:#eef3f4;}
.time-night {background:#0c0c0c;}

/* --- Progress bar --- */
.progress-container {
  background:#ddd;
  width:100%;
  border-radius:4px;
  height:20px;
  position:relative;
}
.progress-bar {
  height:100%;
  border-radius:4px;
  width:0%;
  transition: width 0.3s;
}
.progress-work {background:#e70303;}
.progress-sleep {background:#06f502;}
.progress-other {background:#3d4240;}

/* --- Summary bar --- */
.summary-container {
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-bottom:20px;
}
.summary-bar {
  display:flex;
  flex-direction:column;
  font-size:12px;
}
.summary-bar div {
  width:100%;
  background:#e8eaea;
  border-radius:4px;
  height:20px;
  position:relative;
}
.summary-bar div span {
  position:absolute;
  left:5px;
  top:0;
  font-size:12px;
  line-height:20px;
}

/* Button */
button {
  padding:6px 12px;
  border:none;
  background:#f1f4f5;
  color:rgb(245, 3, 3);
  border-radius:4px;
  cursor:pointer;
}
button:hover {
  background:#010f0f;
}

/* Responsif */
@media(max-width:480px){
  table, thead, tbody, th, td, tr {
    font-size:12px;
  }
}
</style>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>

<h1>ğ€ğŠğ“ğˆğ•ğˆğ“ğ€ğ’ ğ‡ğ€ğ‘ğˆğ€ğ ğ‡ğ„ğ‘ğˆ</h1>

<div class="top-controls">
  <input type="date" id="filterDate" onchange="filterByDate()">
  <button onclick="addRow()">ğ“ğšğ¦ğ›ğšğ¡ ğ‘ğ¨ğ°</button>
  <button onclick="saveToFirebase()">ğ’ğ¢ğ¦ğ©ğšğ§</button>
</div>
<!-- BAR JADWAL DR LASER -->
<a href="https://heriyandi9494-cloud.github.io/drlaser/" target="_blank" 
   style="
      display:block;
      width:100%;
      background:#f1f3f5;
      padding:12px;
      text-align:center;
      color:rgb(233, 10, 10);
      font-size:20px;
      font-weight:bold;
      border-radius:8px;
      margin-top:15px;
      text-decoration:none;
      box-shadow:0 0 10px rgba(5, 251, 17, 0.6);
      transition:0.3s;
   "
   onmouseover="this.style.background='#3aa0ff'"
   onmouseout="this.style.background='#1e90ff'">
   ğ‰ğ€ğƒğ–ğ€ğ‹ ğƒğ‘ ğ‹ğ€ğ’ğ„ğ‘ ğ‡ğ„ğ‘ğˆ
</a>

<div class="summary-container">
  <div class="summary-bar">ğŠğ„ğ‘ğ‰ğ€: <div><span id="progressWork"></span></div></div>
  <div class="summary-bar">ğ€ğŠğ“ğˆğ•ğˆğ“ğ€ğ’ ğ‹ğ€ğˆğğğ˜ğ€: <div><span id="progressOther"></span></div></div>
  <div class="summary-bar">ğ“ğˆğƒğ”ğ‘: <div><span id="progressSleep"></span></div></div>
</div>

<table id="activityTable">
  <thead>
    <tr>
      <th>ğğ</th>
      <th>ğ‡ğ€ğ‘ğˆ</th>
      <th>ğ“ğ€ğğ†ğ†ğ€ğ‹</th>
      <th>ğ‰ğ„ğğˆğ’ ğŠğ„ğ†ğˆğ€ğ“ğ€ğ</th>
      <th>ğŒğ”ğ‹ğ€ğˆ</th>
      <th>ğ’ğ„ğ‹ğ„ğ’ğ€ğˆ</th>
      <th>ğƒğ”ğ‘ğ€ğ’ğˆ ğ–ğ€ğŠğ“ğ”</th>
      <th>ğğ‘ğğ†ğ‘ğ„ğ’</th>
      <th>ğ€ğŠğ’ğˆ</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>

/* ---------- KONFIGURASI FIREBASE (ganti config bila perlu) ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyCHnFBBhKUg9I0f84ai8_X7kcuQjqgSK5w",
  authDomain: "loginaksi.firebaseapp.com",
  databaseURL: "https://loginaksi-default-rtdb.firebaseio.com",
  projectId: "loginaksi",
  storageBucket: "loginaksi.firebasestorage.app",
  messagingSenderId: "720249983474",
  appId: "1:720249983474:web:169e0d8aa713cd2b699b6b",
  measurementId: "G-3P37QDYG60"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ---------- DATA & UTILS ---------- */
const days = ['Senin','Selasa','Rabu','Kamis','Jumat','Sabtu','Minggu'];
const activityTypes = ['Mandi','Santai','Telponan','Berangkat Kerja','Kerja','Pulang Kerja','Gym','Playgame','Tidur','Doa'];

function convertTextToHours(text) {
  if(!text) return 0;
  const jam = (text.match(/(\d+)j/) || [0,0])[1]*1;
  const menit = (text.match(/(\d+)m/) || [0,0])[1]*1;
  return jam + menit/60;
}

function formatDuration(hoursFloat){
  if(isNaN(hoursFloat)) return "0j 0m";
  const jam=Math.floor(hoursFloat);
  const menit=Math.round((hoursFloat-jam)*60);
  return `${jam}j ${menit}m`;
}

function getProgressDescription(type, hoursFloat){
  if(type==='Kerja'||type==='Berangkat Kerja'||type==='Pulang Kerja'){
    return `ğ™·ğšğš›ğš’ ğšœğšğšğšŠğš—ğš ğ™±ğšğš”ğšğš›ğš“ğšŠ (${formatDuration(hoursFloat)})`;
  } else if(type==='Tidur'){
    return `ğ™·ğšğš›ğš’ ğšœğšğšğšŠğš—ğš ğšƒğš’ğšğšğš› (${formatDuration(hoursFloat)})`;
  } else if(type){
    return `ğ™·ğšğš›ğš’ ğšœğšğšğšŠğš—ğš ğ™±ğšğš›ğšŠğš”ğšğš’ğšŸğš’ğšğšŠğšœ (${formatDuration(hoursFloat)})`;
  }
  return '';
}

function getSummaryText(category, percent){
  percent = parseFloat(percent);
  if(category==='work'){
    if(percent<=0) return "ğ˜½ğ™šğ™¡ğ™ªğ™¢ ğ™–ğ™™ğ™– ğ™Ÿğ™–ğ™¢ ğ™ ğ™šğ™§ğ™Ÿğ™–";
    if(percent<=30) return "ğ™†ğ™šğ™§ğ™Ÿğ™– ğ™§ğ™ğ™£ğ™œğ™–ğ™£";
    if(percent<=60) return "ğ™…ğ™–ğ™¢ ğ™†ğ™šğ™§ğ™Ÿğ™–ğ™¢ğ™ª ğ™ˆğ™–ğ™¨ğ™ğ™ ğ™„ğ™™ğ™šğ™–ğ™¡";
    return "ğ™…ğ™–ğ™¢ ğ™†ğ™šğ™§ğ™Ÿğ™–ğ™¢ğ™ª ğ™ğ™–ğ™£ğ™œğ™–ğ™© ğ™ğ™ğ™£ğ™œğ™œğ™";
  } else if(category==='other'){
    if(percent<=0) return "ğ˜½ğ™šğ™¡ğ™ªğ™¢ ğ™–ğ™™ğ™– ğ™–ğ™ ğ™©ğ™ğ™«ğ™ğ™©ğ™–ğ™¨ ğ™¡ğ™–ğ™ğ™£";
    if(percent<=30) return "ğ˜¼ğ™ ğ™©ğ™ğ™«ğ™ğ™©ğ™–ğ™¨ ğ™§ğ™ğ™£ğ™œğ™–ğ™£";
    if(percent<=60) return "ğ˜¼ğ™ ğ™©ğ™ğ™«ğ™ğ™©ğ™–ğ™¨ğ™¢ğ™ª ğ™˜ğ™ªğ™ ğ™ªğ™¥";
    return "ğ˜¼ğ™ ğ™©ğ™ğ™«ğ™ğ™©ğ™–ğ™¨ğ™¢ğ™ª ğ™—ğ™šğ™§ğ™¡ğ™šğ™—ğ™ğ™ğ™–ğ™£";
  } else if(category==='sleep'){
    if(percent<=0) return "ğ˜½ğ™šğ™¡ğ™ªğ™¢ ğ™©ğ™ğ™™ğ™ªğ™§";
    if(percent<=30) return "ğ™ğ™ğ™™ğ™ªğ™§ğ™¢ğ™ª ğ™ ğ™ªğ™§ğ™–ğ™£ğ™œ";
    if(percent<=60) return "ğ™…ğ™–ğ™¢ ğ™©ğ™ğ™™ğ™ªğ™§ğ™¢ğ™ª ğ™˜ğ™ªğ™ ğ™ªğ™¥";
    return "ğ™ğ™ğ™™ğ™ªğ™§ğ™¢ğ™ª ğ™—ğ™šğ™§ğ™¡ğ™šğ™—ğ™ğ™ğ™–ğ™£";
  }
  return percent+"%";
}

/* ---------- TABEL ---------- */
function addRow(data={}) {
  const tbody=document.querySelector('#activityTable tbody');
  const row=tbody.insertRow();
  const idx=tbody.rows.length;
  row.innerHTML=`
    <td>${idx}</td>
    <td class="day-cell">
      <select onchange="updateRowColor(this); updateDuration(this)">
        ${days.map(d=>`<option value="${d}" ${(data.hari===d)?'selected':''}>${d}</option>`).join('')}
      </select>
    </td>
    <td><input type="date" value="${data.tanggal||''}" onchange="autoSetDay(this); updateDuration(this)"></td>
    <td>
      <select onchange="updateDuration(this)">
        ${activityTypes.map(a=>`<option ${data.jenis===a?'selected':''}>${a}</option>`).join('')}
      </select>
    </td>
    <td><input type="time" value="${data.mulai||''}" onchange="updateDuration(this); updateTimeColor(this)"></td>
    <td><input type="time" value="${data.selesai||''}" onchange="updateDuration(this); updateTimeColor(this)"></td>
    <td class="duration">0j 0m</td>
    <td>
      <div class="progress-container">
        <div class="progress-bar"></div>
      </div>
      <div class="activity-text" style="margin-top:4px;font-size:12px;"></div>
    </td>
    <td><button onclick="removeRow(this)">ğ‡ğšğ©ğ®ğ¬</button></td>
  `;
  updateRowColor(row.cells[1].querySelector('select'));
  calculateAllRows();
}

/* hapus row */
function removeRow(btn){
  btn.closest('tr').remove();
  calculateAllRows();
}

/* update warna hari */
function updateRowColor(select){
  const val=select.value.toLowerCase();
  const cell=select.parentElement;
  cell.className='day-cell';
  const map={
    'senin':'day-senin','selasa':'day-selasa','rabu':'day-rabu','kamis':'day-kamis',
    'jumat':'day-jumat','sabtu':'day-sabtu','minggu':'day-minggu'
  };
  if(map[val]) cell.classList.add(map[val]);
}

/* set hari dari tanggal */
function getDayName(dateString){
  if(!dateString) return '';
  const d=new Date(dateString+'T00:00:00');
  return days[d.getDay()==0?6:d.getDay()-1]; // 0=Minggu
}
function autoSetDay(input){
  const row=input.closest('tr');
  const daySelect=row.cells[1].querySelector('select');
  daySelect.value=getDayName(input.value);
  updateRowColor(daySelect);
}

/* warna time */
function updateTimeColor(input){
  const h=parseInt(input.value.split(':')[0]||0);
  const cell=input.parentElement;
  cell.classList.remove('time-morning','time-night');
  if(h<6||h>=18) cell.classList.add('time-night'); else cell.classList.add('time-morning');
}

/* hitung durasi */
function updateDuration(el){
  const row=el.closest('tr');
  const type=row.cells[3].querySelector('select').value;
  const start=row.cells[4].querySelector('input').value;
  const end=row.cells[5].querySelector('input').value;
  let dur=0;
  if(start&&end){
    let [sh,sm]=start.split(':').map(n=>parseInt(n));
    let [eh,em]=end.split(':').map(n=>parseInt(n));
    let diff=(eh*60+em)-(sh*60+sm);
    if(diff<0) diff+=24*60;
    dur=diff/60;
  }
  row.cells[6].innerText=formatDuration(dur);

  // progress bar
  const total=getTotalHours()||1;
  const percent=(dur/total*100).toFixed(1);
  const bar=row.querySelector('.progress-bar');
  bar.style.width=percent+'%';
  bar.className='progress-bar';
  if(type==='Kerja'||type==='Berangkat Kerja'||type==='Pulang Kerja') bar.classList.add('progress-work');
  else if(type==='Tidur') bar.classList.add('progress-sleep');
  else bar.classList.add('progress-other');

  row.querySelector('.activity-text').innerText=getProgressDescription(type,dur);

  showSummary();
}

/* total jam (semua row) */
function getTotalHours(filterDate=null){
  let total=0;
  document.querySelectorAll('#activityTable tbody tr').forEach(row=>{
    const dateVal=row.cells[2].querySelector('input').value;
    if(!filterDate || filterDate===dateVal)
      total+=convertTextToHours(row.cells[6].innerText);
  });
  return total;
}

/* summary */
function showSummary(){
  const totalWork=Array.from(document.querySelectorAll('#activityTable tbody tr'))
    .filter(r=>['Kerja','Berangkat Kerja','Pulang Kerja'].includes(r.cells[3].querySelector('select').value))
    .reduce((s,r)=>s+convertTextToHours(r.cells[6].innerText),0);
  const totalSleep=Array.from(document.querySelectorAll('#activityTable tbody tr'))
    .filter(r=>r.cells[3].querySelector('select').value==='Tidur')
    .reduce((s,r)=>s+convertTextToHours(r.cells[6].innerText),0);
  const totalOther=Array.from(document.querySelectorAll('#activityTable tbody tr'))
    .filter(r=>!['Kerja','Berangkat Kerja','Pulang Kerja','Tidur'].includes(r.cells[3].querySelector('select').value))
    .reduce((s,r)=>s+convertTextToHours(r.cells[6].innerText),0);

  const total=totalWork+totalSleep+totalOther || 1;

  document.getElementById('progressWork').innerText=getSummaryText('work',totalWork/total*100);
  document.getElementById('progressOther').innerText=getSummaryText('other',totalOther/total*100);
  document.getElementById('progressSleep').innerText=getSummaryText('sleep',totalSleep/total*100);
}

/* filter by date */
function filterByDate(){
  const fd=document.getElementById('filterDate').value;
  document.querySelectorAll('#activityTable tbody tr').forEach(row=>{
    const d=row.cells[2].querySelector('input').value;
    row.style.display=!fd || fd===d?'':'none';
  });
  calculateAllRows();
}

/* update semua row */
function calculateAllRows(){
  document.querySelectorAll('#activityTable tbody tr').forEach(row=>{
    updateDuration(row.cells[3].querySelector('select'));
  });
}

/* ---------- Firebase ---------- */
function saveToFirebase(){
  const data=[];
  document.querySelectorAll('#activityTable tbody tr').forEach(row=>{
    data.push({
      hari: row.cells[1].querySelector('select').value,
      tanggal: row.cells[2].querySelector('input').value,
      jenis: row.cells[3].querySelector('select').value,
      mulai: row.cells[4].querySelector('input').value,
      selesai: row.cells[5].querySelector('input').value,
      durasi: convertTextToHours(row.cells[6].innerText)
    });
  });
  db.ref('jadwal').set(data).then(()=>alert('Tersimpan di Firebase'))
  .catch(e=>alert('Error: '+e));
}

function loadFromFirebase(){
  db.ref('jadwal').on('value', snapshot=>{
    const val=snapshot.val();
    const tbody=document.querySelector('#activityTable tbody');
    tbody.innerHTML='';
    if(val) Object.values(val).forEach(item=>addRow(item));
    else addRow();
    calculateAllRows();
  });
}

window.addEventListener('DOMContentLoaded',()=>{
  loadFromFirebase();
});
</script>
</body>
</html>
