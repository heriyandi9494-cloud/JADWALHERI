<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jadwal Aktivitas Sehari-hari</title>
<style>
.progress-kerja {
  background-color: #f10404 !important; /* merah */
}
.progress-tidur {
  background-color: #07e83b !important; /* hijau */
}
.progress-lain {
  background-color: #ffc107 !important; /* kuning */
}
.time-morning {
  background-color: #17ec08 !important;  /* hijau muda */
}

.time-night {
  background-color: #ec061d !important;  /* merah muda */
}
body { font-family: Arial; margin:0; padding:10px; background:#f4f4f4;}
h2{text-align:center;}
table{width:100%;border-collapse:collapse;margin-bottom:10px;}
th, td{padding:6px;border:1px solid #da0c0c;text-align:center;font-size:14px;}
th{background-color:#6fa9e7;color:rgb(229, 13, 13);}
.day-senin { background-color: #f4c805 !important; }
.day-selasa { background-color: #0bf20b !important; }
.day-rabu { background-color: #0707e3 !important; }
.day-kamis { background-color: #09c2f0 !important; }
.day-jumat { background-color: #e50de5 !important; }
.day-sabtu { background-color: #db3c02 !important; }
.day-minggu { background-color: #f70101 !important; }
select, input{width:100%;padding:4px;box-sizing:border-box;}
button{padding:8px 12px; margin:5px 2px; background:#007BFF; color:white; border:none; border-radius:6px; cursor:pointer; font-size:14px;}
button:hover{background:#0056b3;}
#summary{margin-top:10px; padding:10px; background:#fff; border-radius:8px; font-size:14px;}
.progress-container{ width:100%; background-color:#ddd; border-radius:12px; overflow:hidden; margin-top:4px;}
.progress-bar{ height:16px; text-align:right; padding-right:4px; line-height:16px; color:white; font-size:12px;}
.progress-work{background-color:#e80707;}       /* hijau */
.progress-other{background-color:#ffc107;}      /* kuning */
.progress-sleep{background-color:#07ea29;}      /* biru */
.progress-activity-bar{background-color:#007BFF;} /* untuk tabel per aktivitas */
@media screen and (max-width:600px){ th, td{font-size:12px;padding:4px;} button{font-size:12px;padding:6px;} }
</style>
</head>
<body>

<h2>ğ‰ğ€ğƒğ–ğ€ğ‹ ğ€ğŠğ“ğˆğ•ğˆğ“ğ€ğ’ ğ‡ğ„ğ‘ğˆ ğ’ğ„ğ‡ğ€ğ‘-ğ‡ğ€ğ‘ğˆ</h2>

<label for="filterDate">ğ…ğ¢ğ¥ğ­ğğ« ğ“ğšğ§ğ ğ ğšğ¥ ğ”ğ§ğ­ğ®ğ¤ ğŒğğ¥ğ¢ğ¡ğšğ­ ğ€ğ¤ğ­ğ¢ğ¯ğ¢ğ­ğšğ¬ ğ‹ğšğ¢ğ§ğ§ğ²ğš:</label>
<input type="date" id="filterDate" onchange="filterByDate()">

<table id="activityTable">
<thead>
<tr>
  <th>ğ—¡ğ—¢</th>
  <th>ğ—›ğ—”ğ—¥ğ—œ</th>
  <th>ğ“ğ€ğğ†ğ†ğ€ğ‹</th>
  <th>ğ—ğ—˜ğ—¡ğ—œğ—¦ ğ—”ğ—ğ—§ğ—œğ—©ğ—œğ—§ğ—”ğ—¦</th>
  <th>ğ—ªğ—”ğ—ğ—§ğ—¨ ğ— ğ—¨ğ—Ÿğ—”ğ—œ</th>
  <th>ğ—ªğ—”ğ—ğ—§ğ—¨ ğ—¦ğ—˜ğ—Ÿğ—˜ğ—¦ğ—”ğ—œ</th>
  <th>ğ——ğ—¨ğ—¥ğ—”ğ—¦ğ—œ/ğ—ğ—”ğ— </th>
  <th>ğ—ğ—˜ğ—§ğ—˜ğ—¥ğ—”ğ—¡ğ—šğ—”ğ—¡ (%)</th>
  <th>ğ—”ğ—ğ—¦ğ—œ</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button onclick="addRow()">ğ“ğšğ¦ğ›ğšğ¡ ğ€ğ¤ğ­ğ¢ğ¯ğ¢ğ­ğšğ¬</button>
<button onclick="saveToFirebase()">ğ’ğ¢ğ¦ğ©ğšğ§</button>
<button onclick="showSummary()">ğğšğ§ğ­ğšğ® ğ€ğ¤ğ­ğ¢ğ¯ğ¢ğ­ğšğ¬ ğ‡ğğ«ğ¢</button>

<div id="summary">
<h3>ğ‘ğšğ§ğ ğ¤ğ®ğ¦ğšğ§ ğ‡ğšğ«ğ¢ ğˆğ§ğ¢</h3>
<p>ğŠğ„ğ“ğ„ğ‘ğ€ğğ†ğ€ğ ğ‰ğ€ğŒ ğŠğ„ğ‘ğ‰ğ€:
  <div class="progress-container"><div id="progressWork" class="progress-bar progress-work" style="width:0%">0%</div></div>
</p>
<p>ğ€ğ¤ğ­ğ¢ğ¯ğ¢ğ­ğšğ¬ ğ‹ğšğ¢ğ§ğ§ğ²ğš:
  <div class="progress-container"><div id="progressOther" class="progress-bar progress-other" style="width:0%">0%</div></div>
</p>
<p>ğŠğ„ğ“ğ„ğ‘ğ€ğğ†ğ€ğ ğ‰ğ€ğŒ ğ“ğˆğƒğ”ğ‘ :
  <div class="progress-container"><div id="progressSleep" class="progress-bar progress-sleep" style="width:0%">0%</div></div>
</p>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
function getSummaryText(category, percentage) {
  if (category === "work") {
    if (percentage == 0) return "ğ˜½ğ™šğ™¡ğ™ªğ™¢ ğ™–ğ™™ğ™– ğ™Ÿğ™–ğ™¢ ğ™ ğ™šğ™§ğ™Ÿğ™–";
    if (percentage <= 30) return "ğ™†ğ™šğ™§ğ™Ÿğ™– ğ™§ğ™ğ™£ğ™œğ™–ğ™£";
    if (percentage <= 60) return "ğ™†ğ™šğ™§ğ™Ÿğ™– ğ™˜ğ™ªğ™ ğ™ªğ™¥";
    return "ğ™…ğ™–ğ™¢ ğ™†ğ™šğ™§ğ™Ÿğ™–ğ™¢ğ™ª ğ™ğ™–ğ™£ğ™œğ™–ğ™© ğ™ğ™ğ™£ğ™œğ™œğ™";
  }

  if (category === "other") {
    if (percentage == 0) return "ğ™ğ™ğ™™ğ™–ğ™  ğ™–ğ™™ğ™– ğ™–ğ™ ğ™©ğ™ğ™«ğ™ğ™©ğ™–ğ™¨ ğ™¡ğ™–ğ™ğ™£";
    if (percentage <= 30) return "ğ˜¼ğ™ ğ™©ğ™ğ™«ğ™ğ™©ğ™–ğ™¨ ğ™ğ™ğ™£ğ™œğ™–ğ™£";
    if (percentage <= 60) return "ğ˜¼ğ™ ğ™©ğ™ğ™«ğ™ğ™©ğ™–ğ™¨ ğ™ğ™šğ™™ğ™–ğ™£ğ™œ";
    return "ğ€ğ¤ğ­ğ¢ğ¯ğ¢ğ­ğšğ¬ ğ“ğ¢ğ§ğ ğ ğ¢";
  }

  if (category === "sleep") {
    if (percentage == 0) return "ğ˜½ğ™šğ™¡ğ™ªğ™¢ ğ™ğ™ğ™™ğ™ªğ™§";
    if (percentage <= 30) return "ğ™ğ™ğ™™ğ™ªğ™§ğ™¢ğ™ª ğ™†ğ™ªğ™§ğ™–ğ™£ğ™œ";
    if (percentage <= 60) return "ğ™ğ™ğ™™ğ™ªğ™§ğ™¢ğ™ª ğ˜¾ğ™ªğ™ ğ™ªğ™¥";
    return "ğ™ğ™ğ™™ğ™ªğ™§ğ™¢ğ™ª ğ™¨ğ™–ğ™£ğ™œğ™–ğ™© ğ™—ğ™–ğ™ğ™ ";
  }
}
function getProgressText(type) {
  if (type === "Kerja") return "ğ™ƒğ™šğ™§ğ™ ğ™ğ™šğ™™ğ™–ğ™£ğ™œ ğ˜½ğ™šğ™ ğ™šğ™§ğ™Ÿğ™–";
  if (type === "Tidur") return "ğ™ƒğ™šğ™§ğ™ ğ™ğ™šğ™™ğ™–ğ™£ğ™œ ğ™ğ™ğ™™ğ™ªğ™§";
  
  const otherActivities = ["Mandi","Santai","Telponan","BerangkatKerja","PulangKerja","Gym","Playgame","Doa"];
  if (otherActivities.includes(type)) return "ğ™ƒğ™šğ™§ğ™ ğ™ğ™šğ™™ğ™–ğ™£ğ™œ ğ™ˆğ™šğ™¡ğ™–ğ™ ğ™ªğ™ ğ™–ğ™£ ğ˜¼ğ™ ğ™©ğ™ğ™«ğ™ğ™©ğ™–ğ™¨";
  
  return ""; // default jika type tidak ada
}


function updateTimeColor(select) {
  const cell = select.parentNode; 
  const time = select.value;
  const hour = parseInt(time.split(":")[0]);

  // reset warna
  cell.classList.remove("time-morning", "time-night");

  if (hour >= 18) {
    cell.classList.add("time-night");   // jam 18â€“24 â†’ merah
  } else {
    cell.classList.add("time-morning"); // jam 00â€“18 â†’ hijau
  }
}

// Konfigurasi Firebase (ganti dengan milik Anda)
const firebaseConfig = {
  apiKey: "AIzaSyCHnFBBhKUg9I0f84ai8_X7kcuQjqgSK5w",
  authDomain: "loginaksi.firebaseapp.com",
  databaseURL: "https://loginaksi-default-rtdb.firebaseio.com",
  projectId: "loginaksi",
  storageBucket: "loginaksi.firebasestorage.app",
  messagingSenderId: "720249983474",
  appId: "1:720249983474:web:169e0d8aa713cd2b699b6b",
  measurementId: "G-3P37QDYG60"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const days=['Senin','Selasa','Rabu','Kamis','Jumat','Sabtu','Minggu'];
const activityTypes=['Mandi','Santai','Telponan','BerangkatKerja','Kerja','PulangKerja','Gym','Playgame','Tidur','Doa'];
const times=[];
for(let h=0;h<24;h++){for(let m=0;m<60;m+=5){let hh=h.toString().padStart(2,'0'); let mm=m.toString().padStart(2,'0'); times.push(`${hh}:${mm}`);}}

let allData=[];


// Tambah baris baru
function addRow(data={}){
  const table=document.getElementById('activityTable').getElementsByTagName('tbody')[0];
  const row=table.insertRow();
  const rowIndex=table.rows.length;

  row.innerHTML=`
    <td>${rowIndex}</td>
    <td><select onchange="updateRowColor(this)">${days.map(day=>`<option value="${day.toLowerCase()}" ${data.hari===day?'selected':''}>${day}</option>`).join('')}</select></td>
    <td><input type="date" value="${data.tanggal||''}" onchange="updateDataArray(this)"></td>
    <td><select onchange="updateDataArray(this)">${activityTypes.map(act=>`<option ${data.jenis===act?'selected':''}>${act}</option>`).join('')}</select></td>
    <td><select onchange="updateDuration(this); updateTimeColor(this)">
    ${times.map(t=>`<option ${data.mulai===t?'selected':''}>${t}</option>`).join('')}
    </select></td>
    <td><select onchange="updateDuration(this); updateTimeColor(this)">
    ${times.map(t=>`<option ${data.selesai===t?'selected':''}>${t}</option>`).join('')}
    </select></td>

    <td class="duration">0</td>
    <td class="percentage"><div class="progress-container"><div class="progress-bar progress-activity-bar" style="width:0%">0%</div></div></td>
    <td><button onclick="removeRow(this)">Hapus</button></td>
  `;
  updateRowColor(row.cells[1].children[0]);
  allData.push({row,rowData:data});
}

function updateRowColor(select){
  const row = select.parentNode.parentNode;
  const cell = row.cells[1];  // kolom Hari
  const day = select.value.toLowerCase();

  // hapus semua class warna hari
  cell.className = "";

  // beri class sesuai hari
  cell.classList.add("day-" + day);

  updateDuration(select);
}

function removeRow(btn){
  const row=btn.parentNode.parentNode;
  const index=allData.findIndex(e=>e.row===row);
  if(index>-1) allData.splice(index,1);
  row.parentNode.removeChild(row);
  updateRowNumbers();
}

function updateRowNumbers(){
  const table=document.getElementById('activityTable').getElementsByTagName('tbody')[0];
  Array.from(table.rows).forEach((row,i)=>{row.cells[0].innerText=i+1;});
}

function updateDuration(select){
  const row = select.parentNode.parentNode;
  const type = row.cells[3].children[0].value;
  const start = row.cells[4].children[0].value.split(':').map(Number);
  const end = row.cells[5].children[0].value.split(':').map(Number);

  let duration = (end[0]*60 + end[1]) - (start[0]*60 + start[1]);
  if(duration < 0) duration += 24*60;
  duration = (duration / 60).toFixed(2);
  row.cells[6].innerText = duration;

  // Hitung persen
  const totalHours = getTotalHours();
  const perc = totalHours ? ((duration / totalHours) * 100).toFixed(1) : 0;

  const progressBar = row.cells[7].children[0].children[0];
  progressBar.style.width = perc + "%";

  // ==========================
  // Tampilkan angka persen (%)
  // ==========================
  progressBar.innerText = perc + "%";

  // Warna otomatis
  progressBar.classList.remove("progress-kerja", "progress-tidur", "progress-lain");
  if (type === "Kerja") progressBar.classList.add("progress-kerja");
  else if (type === "Tidur") progressBar.classList.add("progress-tidur");
  else progressBar.classList.add("progress-lain");
}

function updateDataArray(input){
  const row=input.parentNode.parentNode;
  const index=allData.findIndex(e=>e.row===row);
  if(index>-1){
    allData[index].rowData.hari=row.cells[1].children[0].value;
    allData[index].rowData.tanggal=row.cells[2].children[0].value;
    allData[index].rowData.jenis=row.cells[3].children[0].value;
    allData[index].rowData.mulai=row.cells[4].children[0].value;
    allData[index].rowData.selesai=row.cells[5].children[0].value;
  }
}

function getTotalHours(filterDate=null){
  const table=document.getElementById('activityTable').getElementsByTagName('tbody')[0];
  let sum=0;
  Array.from(table.rows).forEach(row=>{
    if(!filterDate || row.cells[2].children[0].value===filterDate){
      sum+=parseFloat(row.cells[6].innerText);
    }
  });
  return sum;
}

function showSummary(filterDate=null){
  const table=document.getElementById('activityTable').getElementsByTagName('tbody')[0];
  let totalWork=0, other=0, sleep=0;
  Array.from(table.rows).forEach(row=>{
    if(!filterDate || row.cells[2].children[0].value===filterDate){
      const type=row.cells[3].children[0].value;
      const duration=parseFloat(row.cells[6].innerText);
      if(type==='Kerja') totalWork+=duration;
      else if(type==='Tidur') sleep+=duration;
      else other+=duration;
    }
  });
  const total=totalWork+other+sleep || 1;
  const workPerc=(totalWork/total*100).toFixed(1);
  const otherPerc=(other/total*100).toFixed(1);
  const sleepPerc=(sleep/total*100).toFixed(1);

  document.getElementById('progressWork').style.width=workPerc+'%';
  document.getElementById('progressWork').innerText = 
    getSummaryText("work", workPerc);
  document.getElementById('progressOther').style.width=otherPerc+'%';
  document.getElementById('progressOther').innerText = 
    getSummaryText("other", otherPerc);
  document.getElementById('progressSleep').style.width=sleepPerc+'%';
  document.getElementById('progressSleep').innerText = 
    getSummaryText("sleep", sleepPerc);
}

function filterByDate(){
  const filterDate=document.getElementById('filterDate').value;
  const table=document.getElementById('activityTable').getElementsByTagName('tbody')[0];
  Array.from(table.rows).forEach(row=>{
    if(!filterDate || row.cells[2].children[0].value===filterDate){
      row.style.display='';
    } else {
      row.style.display='none';
    }
  });
  showSummary(filterDate);
}

// Simpan semua data ke Firebase
function saveToFirebase() {
  const table = document.getElementById("activityTable").getElementsByTagName("tbody")[0];
  const data = [];

  Array.from(table.rows).forEach(row => {
    data.push({
      hari: row.cells[1].children[0].value,
      tanggal: row.cells[2].children[0].value,
      jenis: row.cells[3].children[0].value,
      mulai: row.cells[4].children[0].value,
      selesai: row.cells[5].children[0].value,
      durasi: parseFloat(row.cells[6].innerText)
    });
  });

  db.ref("jadwal")
    .set(data)
    .then(() => alert("Data berhasil disimpan di Firebase"))
    .catch(err => alert("Error: " + err));
}

// Load data dari Firebase saat halaman dibuka
function loadFromFirebase(){
  db.ref('jadwal').on('value', snapshot=>{
    const val=snapshot.val();
    const table=document.getElementById('activityTable').getElementsByTagName('tbody')[0];
    table.innerHTML='';
    allData=[];
    if(val){
      val.forEach(item=>addRow(item));
    } else addRow();
    showSummary();
  });
}

// Inisialisasi halaman
loadFromFirebase();
</script>

</body>
</html>
