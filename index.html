<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jadwal Aktivitas Sehari-hari</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background-color: #f0f4f8; font-family: Arial, sans-serif; padding: 20px; }
  table { width: 100%; border-collapse: collapse; }
  th, td { text-align: center; padding: 10px; border-radius: 8px; transition: all 0.3s ease; }
  th { background-color: #ee0a25; color: white; }
  tr:nth-child(even) td { background-color: #e3f2fd; }
  tr:hover td { background-color: #ffe082; cursor: pointer; }
  select, input[type="time"], input[type="date"] { width: 100%; padding: 5px; border-radius: 5px; border: 1px solid #ccc; }
  .keterangan { font-weight: bold; color: #d32f2f; }
  .Tidur { background-color: #b2dfdb !important; }
  .Kerja { background-color: #ffcc80 !important; }
  .Belajar { background-color: #c5cae9 !important; }
  .Olahraga { background-color: #aed581 !important; }
  .Santai { background-color: #f48fb1 !important; }
  .hapus-btn { color: #fff; background-color: #d32f2f; border: none; padding: 3px 7px; border-radius: 5px; cursor: pointer; }
</style>
</head>
<body>

<h2 class="text-center mb-4">ğ‰ğšğğ°ğšğ¥ ğ€ğ¤ğ­ğ¢ğ¯ğ¢ğ­ğšğ¬ ğ‡ğğ«ğ¢ ğ’ğğ¡ğšğ«ğ¢-ğ¡ğšğ«ğ¢</h2>

<div class="mb-3">
  <label>ğğ¢ğ¥ğ¢ğ¡ ğ“ğšğ§ğ ğ ğšğ¥:</label>
  <input type="date" id="filterTanggal" onchange="updateProgressBars()">
</div>

<div class="mb-3">
  <label>ğ“ğ¨ğ­ğšğ¥ ğ‰ğšğ¦ ğŠğğ«ğ£ğš:</label>
  <div class="progress mb-2">
    <div id="progressKerja" class="progress-bar bg-primary" role="progressbar" style="width:0%">0 Jam</div>
  </div>

  <label>ğ€ğ¤ğ­ğ¢ğ¯ğ¢ğ­ğšğ¬ ğ‹ğšğ¢ğ§:</label>
  <div class="progress mb-2">
    <div id="progressLain" class="progress-bar bg-warning" role="progressbar" style="width:0%">0% - </div>
  </div>

  <label>ğ“ğ¢ğğ®ğ«:</label>
  <div class="progress mb-3">
    <div id="progressTidur" class="progress-bar bg-success" role="progressbar" style="width:0%">0% - </div>
  </div>
</div>

<table class="table table-responsive" id="jadwal-table">
  <thead>
    <tr>
      <th>No.</th>
      <th>Hari</th>
      <th>Tanggal</th>
      <th>Jenis Aktivitas</th>
      <th>Waktu Mulai</th>
      <th>Waktu Selesai</th>
      <th>Durasi (Jam)</th>
      <th>Keterangan</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody id="jadwal-body"></tbody>
</table>

<script>
let jadwalData = JSON.parse(localStorage.getItem('jadwalData')) || [];
const today = new Date().toISOString().split('T')[0];
document.getElementById('filterTanggal').value = today;

function tambahBaris(data={}, index=null){
  const tbody = document.getElementById('jadwal-body');
  const row = tbody.insertRow(index===null ? -1 : index);

  const no = row.insertCell();
  const hari = row.insertCell();
  const tanggal = row.insertCell();
  const jenis = row.insertCell();
  const mulai = row.insertCell();
  const selesai = row.insertCell();
  const durasi = row.insertCell();
  const keterangan = row.insertCell();
  const aksi = row.insertCell();

  no.innerText = tbody.rows.length;
  hari.contentEditable = true;
  hari.innerText = data.hari || '';
  tanggal.innerHTML = `<input type="date" value="${data.tanggal || today}" onchange="updateData(this)">`;
  jenis.innerHTML = `
    <select onchange="updateData(this)">
      <option value="Tidur" ${data.jenis==='Tidur'?'selected':''}>Tidur</option>
      <option value="Kerja" ${data.jenis==='Kerja'?'selected':''}>Kerja</option>
      <option value="Belajar" ${data.jenis==='Belajar'?'selected':''}>Belajar</option>
      <option value="Olahraga" ${data.jenis==='Olahraga'?'selected':''}>Olahraga</option>
      <option value="Santai" ${data.jenis==='Santai'?'selected':''}>Santai</option>
    </select>
  `;
  mulai.innerHTML = `<input type="time" value="${data.mulai || ''}" onchange="updateData(this)">`;
  selesai.innerHTML = `<input type="time" value="${data.selesai || ''}" onchange="updateData(this)">`;
  durasi.className = 'produktif';
  durasi.innerText = data.durasi || '0';
  keterangan.className = 'keterangan';
  keterangan.innerText = data.keterangan || '';
  aksi.innerHTML = `<button class="hapus-btn" onclick="hapusBaris(this)">Hapus</button>`;

  updateRowColor(row);

  row.querySelectorAll('input, select').forEach(input=>{
    input.addEventListener('change', ()=>{
      hitungDurasi(row);
      updateRowColor(row);
      saveData();
      updateProgressBars();
      if(row.rowIndex === tbody.rows.length && isRowFilled(row)) tambahBaris();
    });
  });

  saveData();
  updateProgressBars();
}

function updateData(elem){
  const row = elem.closest('tr');
  hitungDurasi(row);
  updateRowColor(row);
  saveData();
  updateProgressBars();
}

function isRowFilled(row){
  return [...row.querySelectorAll('input, select')].some(i => i.value);
}

function hitungDurasi(row){
  const mulai = row.cells[4].querySelector('input').value;
  const selesai = row.cells[5].querySelector('input').value;
  const jenis = row.cells[3].querySelector('select').value;
  let dur = 0;
  let keteranganVal = '';

  if(mulai && selesai){
    let start = new Date(`1970-01-01T${mulai}:00`);
    let end = new Date(`1970-01-01T${selesai}:00`);
    dur = (end - start)/(1000*60*60);
    if(dur < 0) dur += 24;

    if(jenis === 'Tidur'){
      const persenTidur = Math.round((dur/8)*100);
      if(dur >= 6){
        keteranganVal = ' Sangat Baik';
      } else {
        keteranganVal = 'Kurang Baik';
      }
    } else if(jenis !== 'Kerja'){ // aktivitas lain
      const persenAktif = Math.round((dur/(24-12))*100);
      keteranganVal = persenAktif >= 75 ? 'Kurang Baik' : 'Cukup Baik';
    } else { // kerja
      keteranganVal = 'ğ“ğ¢ğğšğ¤ ğ›ğšğ¢ğ¤ ğ®ğ§ğ­ğ®ğ¤ ğ¤ğğ¬ğğ¡ğšğ­ğšğ§';
    }
  }

  row.cells[6].innerText = dur.toFixed(2);
  row.cells[7].innerText = keteranganVal;
}

function updateRowColor(row){
  const jenis = row.cells[3].querySelector('select').value;
  row.className = jenis;
}

function saveData(){
  const tbody = document.getElementById('jadwal-body');
  const data = [];
  for(let row of tbody.rows){
    data.push({
      hari: row.cells[1].innerText,
      tanggal: row.cells[2].querySelector('input').value,
      jenis: row.cells[3].querySelector('select').value,
      mulai: row.cells[4].querySelector('input').value,
      selesai: row.cells[5].querySelector('input').value,
      durasi: row.cells[6].innerText,
      keterangan: row.cells[7].innerText
    });
  }
  localStorage.setItem('jadwalData', JSON.stringify(data));
}

function hapusBaris(btn){
  const row = btn.closest('tr');
  row.remove();
  saveData();
  updateNoUrut();
  updateProgressBars();
}

function updateNoUrut(){
  const tbody = document.getElementById('jadwal-body');
  for(let i=0;i<tbody.rows.length;i++) tbody.rows[i].cells[0].innerText = i+1;
}

function updateProgressBars(){
  const tbody = document.getElementById('jadwal-body');
  const filterDate = document.getElementById('filterTanggal').value;

  let totalKerja=0, totalLain=0, countLain=0, totalTidur=0, countTidur=0;

  for(let row of tbody.rows){
    const tanggal = row.cells[2].querySelector('input').value;
    if(!filterDate || tanggal === filterDate){
      const jenis = row.cells[3].querySelector('select').value;
      const dur = parseFloat(row.cells[6].innerText)||0;

      if(jenis === 'Kerja'){
        totalKerja += dur;
      } else if(jenis === 'Tidur'){
        totalTidur += dur;
        countTidur++;
      } else { // aktivitas lain
        totalLain += dur;
        countLain++;
      }
    }
  }

  // Update bars
  document.getElementById('progressKerja').style.width = totalKerja/12*100 + '%';
  document.getElementById('progressKerja').innerText = totalKerja.toFixed(2) + ' ğ“ğ¢ğğšğ¤ ğ›ğšğ¢ğ¤ ğ®ğ§ğ­ğ®ğ¤ ğ¤ğğ¬ğğ¡ğšğ­ğšğ§';

  const persenLain = countLain ? Math.round((totalLain/(24-12))*100) : 0;
  const keteranganLain = persenLain>=75 ? 'ğŠğ®ğ«ğšğ§ğ  ğğšğ¢ğ¤' : 'ğ‚ğ®ğ¤ğ®ğ© ğğšğ¢ğ¤';
  const barLain = document.getElementById('progressLain');
  barLain.style.width = persenLain+'%';
  barLain.innerText = persenLain+'% - '+keteranganLain;

  const persenTidur = countTidur ? Math.round((totalTidur/6)*100) : 0;
  const keteranganTidur = totalTidur>=6 ? 'ğ’ğšğ§ğ ğšğ­ ğğšğ¢ğ¤' : 'ğŠğ®ğ«ğšğ§ğ  ğğšğ¢ğ¤';
  const barTidur = document.getElementById('progressTidur');
  barTidur.style.width = persenTidur+'%';
  barTidur.innerText = persenTidur+'% - '+keteranganTidur;
}

jadwalData.forEach(d=>tambahBaris(d));
if(jadwalData.length===0) tambahBaris();
</script>
</body>
</html>
